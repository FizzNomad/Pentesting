#!/bin/bash

# Function to initiate directory structure
create_directories() {
    clientname="$1"
    mkdir -p ~/clients/"$clientname"/{screens,loot,notes,nessus,enum/{nmap,bloodhound,eyewitness,pcaps,metasploit},logs,cracking,reporting}
}

# Main script
while true; do
    echo "Please select an option:"
    echo " 1. Initiate Testing Environment"
    echo " 2. Run NMAP"
    echo " 3. Dig google.com"
    echo " 4. Print working directory"
    echo " 5. Execute ~/newclient.sh in new terminal"
    echo " 6. Make a mental note"
    echo " 7. Report it!"
    echo " 8. List Findings"
    echo " 9. Quit"

    read -p "Enter your choice (1-9): " option

    case $option in
        1)
            read -p "Enter client name: " clientname

            # Create directory structure
            create_directories "$clientname"

            echo "$clientname Initialized. Have fun storming the castle!"
            ;;
        2)
            read -p "Enter target IP or subnet range: " target
            read -p "Enter client name: " clientname

            echo "Select scan type:"
            echo " 1. SYN scan (-sS)"
            echo " 2. Version scan (-sV)"
            read -p "Enter your choice (1-2): " scantype_option

            case $scantype_option in
                1)
                    scantype="-sS"
                    ;;
                2)
                    scantype="-sV"
                    ;;
                *)
                    echo "Invalid option"
                    continue
                    ;;
            esac

            read -p "Enter path to save the file: " path

            # Create directory path if it does not exist
            mkdir -p "$path"

            filename="$clientname-$(echo $target | sed 's/\//-/g')$scantype"

            sudo nmap $scantype -p- --open "$target" -oA "$path/$filename" -vvvvvv --stats-every 5s
            echo "Scan complete! Results saved to $path/$filename"

            ;;
        3)
            dig google.com
            read -p "Do you want to save the results to a file? (y/n): " save
            if [ "$save" == "y" ]; then
                read -p "Enter filename: " filename
                dig google.com > "$filename"
                echo "Results saved to $filename"
            fi
            ;;
        4)
            pwd
            ;;
        5)
            x-terminal-emulator -e ~/newclient.sh
            ;;
        6)
            if [ ! -d "mental_notes" ]; then
                mkdir mental_notes
            fi
            note_count=$(ls -1 mental_notes/ | wc -l)
            note_count=$(($note_count + 1))
            note_name=$(printf "mental_note-%03d.txt" $note_count)
            echo "Type your mental note (press Ctrl+D to finish):"
            cat > mental_notes/"$note_name"
            echo "Note saved to mental_notes/$note_name"
            ;;
        7)
            if [ ! -d "findings" ]; then
                mkdir findings
            fi
            find_count=$(ls -1 findings/ | wc -l)
            find_count=$(($find_count + 1))
            find_name=$(printf "finding-%03d" $find_count)
            echo "Enter name for finding:"
            read name
            comment=$(printf "%s" "$name" | sed 's/[^a-zA-Z0-9]/_/g')
            find_file="./findings/$find_name-$comment.txt"
            echo "Please enter the details of your finding (press Ctrl+D to finish):"
            cat > "$find_file" <<EOF
# $comment

$(cat)
EOF

            echo "Finding saved as '$comment' in $find_file"
            ;;
        8)
            echo "List of findings:"
            ls -1 ./findings/
            ;;
        9)
            echo "Goodbye!"
            exit 0
            ;;
        *)
            echo "Invalid option"
            ;;
    esac
done
